{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 9b12038a9ff08a900b41","webpack:///./src/lfu-cache.js"],"names":[],"mappings":"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","file":"lfu-cache.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"lfuCache\"] = factory();\n\telse\n\t\troot[\"lfuCache\"] = factory();\n})(this, function() {\nreturn \n\n\n/** WEBPACK FOOTER **\n ** webpack/universalModuleDefinition\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 9b12038a9ff08a900b41\n **/","\nfunction insertionSort(cache) {\n  const len = cache.length;\n  let j;\n  for (let i = 0; i < len; i++) {\n    const tmp = cache[i];\n    for (j = i - 1; j >= 0 && (cache[j].hits > tmp.hits); j--) {\n      cache[j + 1] = cache[j]; // eslint-disable-line no-param-reassign\n    }\n    cache[j + 1] = tmp; // eslint-disable-line no-param-reassign\n  }\n  return cache;\n}\n\nexport default class LFUCache {\n  constructor(options = {}) {\n    if (typeof options === 'number') {\n      options = { max: options }; // eslint-disable-line no-param-reassign\n    }\n    const {\n      max = Infinity,\n      maxAge = 0,\n      length = () => 1,\n      dispose = () => {},\n      stale = false\n    } = options;\n\n    this.max = max;\n    this.maxAge = maxAge;\n    this.lengthCalc = length;\n    this.dispose = dispose;\n    this.stale = stale;\n    this.cache = [];\n  }\n\n  set(key, value, maxAge = this.maxAge) {\n    const now = maxAge ? Date.now() : 0;\n    const length = this.lengthCalc(value, key);\n\n    if (this.has(key)) {\n      if (length > this.max) {\n        this.del(key);\n        return false;\n      }\n\n      const entry = this.cache.get(key);\n      this.dispose(key, entry.value);\n\n      entry.now = now;\n      entry.maxAge = maxAge;\n      entry.value = value;\n      entry.length = length;\n      this.trim(length, entry);\n    }\n    const entry = {\n      key,\n      value,\n      length,\n      now,\n      maxAge,\n      hits: 0\n    };\n\n    if (entry.length > this.max) {\n      this.dispose(key, value);\n    }\n    this.cache.push(entry);\n    this.trim(length);\n    return true;\n  }\n\n  get(key, doUse = true) {\n    const entry = this.cache.find(item => item.key === key);\n    let hit;\n    if (entry) {\n      hit = entry.value;\n      if (this.isStale(hit)) {\n        this.del(entry.key);\n        if (!this.stale) {\n          hit = undefined;\n        } else {\n          if (doUse) {\n            entry.hits++;\n            insertionSort(this.cache);\n          }\n        }\n      }\n    }\n    return hit;\n  }\n\n  peek(key) {\n    this.get(key, false);\n  }\n\n  del(key) {\n    this.cache = this.cache.filter(entry => {\n      if (entry.key === key) {\n        this.dispose(key, entry.value);\n        return false;\n      }\n      return true;\n    });\n  }\n\n  reset() {\n    this.cache.forEach(entry => this.dispose(entry.key, entry.value));\n    this.cache = [];\n  }\n\n  has(key) {\n    return this.peek(key) ? true : false; // eslint-disable-line no-unneeded-ternary\n  }\n\n  forEach(fn, thisp = this) {\n    this.cache.forEach(entry => this.forEachStep(fn, entry, thisp));\n  }\n\n  rforEach(fn, thisp = this) {\n    for (let i = this.cache.length - 1; i >= 0; i++) {\n      this.forEachStep(fn, this.cache[i], thisp);\n    }\n  }\n\n  forEachStep(fn, entry, thisp) {\n    let hit = entry.value;\n    if (this.isStale(entry)) {\n      this.del(entry.key);\n      if (!this.stale) {\n        hit = undefined;\n      }\n    }\n    if (hit) {\n      fn.call(thisp, hit, entry.key, this);\n    }\n  }\n\n  keys() {\n    return this.cache.map(item => item.key);\n  }\n\n  values() {\n    return this.cache.map(item => item.value);\n  }\n\n  get length() {\n    return this.cache.reduce((sum, item) =>\n      item.length\n    , 0);\n  }\n\n  get itemCount() {\n    return this.cache.length;\n  }\n\n  dump() {\n    return this.cache.map(hit => {\n      if (!this.isStale(hit)) {\n        return {\n          k: hit.key,\n          v: hit.value.value,\n          e: hit.now + (hit.maxAge || 0)\n        };\n      }\n      return undefined;\n    }).filter(h => h);\n  }\n\n  dumpLfu() {\n    return this.cache;\n  }\n\n  load(cacheArray) {\n    // reset the cache\n    this.reset();\n\n    const now = Date.now();\n    cacheArray.forEach(entry => {\n      const expiresAt = entry.e || 0;\n      if (expiresAt === 0) {\n        // the item was created without expiration in a non aged cache\n        this.set(entry.k, entry.v);\n      } else {\n        const maxAge = expiresAt - now;\n        // dont add already expired items\n        if (maxAge > 0) {\n          this.set(entry.k, entry.v, maxAge);\n        }\n      }\n    });\n  }\n\n  prune() {\n\n  }\n\n  isStale(hit) {\n    if (!hit || (!hit.maxAge && !this.maxAge)) {\n      return false;\n    }\n    let stale = false;\n    const diff = Date.now() - hit.now;\n    if (hit.maxAge) {\n      stale = diff > hit.maxAge;\n    } else {\n      stale = this.maxAge && (diff > this.maxAge);\n    }\n    return stale;\n  }\n\n  trim(length, prev = { length: 0, key: NaN }) {\n    let capture;\n    while (this.length + length - prev.length > this.max) {\n      const temp = this.cache.pop();\n      if (temp.key === prev.key) {\n        capture = temp;\n      } else {\n        this.del(temp.key);\n      }\n    }\n    if (capture) {\n      this.cache.push(capture);\n    }\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/lfu-cache.js\n **/"],"sourceRoot":""}