!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.lfuCache=t():e.lfuCache=t()}(this,function(){return function(e){function t(i){if(n[i])return n[i].exports;var a=n[i]={exports:{},id:i,loaded:!1};return e[i].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e){for(var t=e.length,n=void 0,i=0;t>i;i++){var a=e[i];for(n=i-1;n>=0&&e[n].hits>a.hits;n--)e[n+1]=e[n];e[n+1]=a}return e}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];n(this,e),"number"==typeof t&&(t={max:t});var i=t,a=i.max,r=void 0===a?1/0:a,u=i.maxAge,o=void 0===u?0:u,h=i.length,s=void 0===h?function(){return 1}:h,c=i.dispose,l=void 0===c?function(){}:c,f=i.stale,v=void 0===f?!1:f;this.max=r,this.maxAge=o,this.lengthCalc=s,this.dispose=l,this.stale=v,this.cache=[]}return a(e,[{key:"set",value:function(e,t){var n=arguments.length<=2||void 0===arguments[2]?this.maxAge:arguments[2],i=n?Date.now():0,a=this.lengthCalc(t,e);if(this.has(e)){if(a>this.max)return this.del(e),!1;var r=this.cache.get(e);this.dispose(e,r.value),r.now=i,r.maxAge=n,r.value=t,r.length=a,this.trim(a,r)}var u={key:e,value:t,length:a,now:i,maxAge:n,hits:0};return u.length>this.max&&this.dispose(e,t),this.cache.push(u),this.trim(a),!0}},{key:"get",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?!0:arguments[1],n=this.cache.find(function(t){return t.key===e}),a=void 0;return n&&(a=n.value,this.isStale(a)&&(this.del(n.key),this.stale?t&&(n.hits++,i(this.cache)):a=void 0)),a}},{key:"peek",value:function(e){this.get(e,!1)}},{key:"del",value:function(e){var t=this;this.cache=this.cache.filter(function(n){return n.key===e?(t.dispose(e,n.value),!1):!0})}},{key:"reset",value:function(){var e=this;this.cache.forEach(function(t){return e.dispose(t.key,t.value)}),this.cache=[]}},{key:"has",value:function(e){return!!this.peek(e)}},{key:"forEach",value:function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?this:arguments[1];this.cache.forEach(function(i){return t.forEachStep(e,i,n)})}},{key:"rforEach",value:function(e){for(var t=arguments.length<=1||void 0===arguments[1]?this:arguments[1],n=this.cache.length-1;n>=0;n++)this.forEachStep(e,this.cache[n],t)}},{key:"forEachStep",value:function(e,t,n){var i=t.value;this.isStale(t)&&(this.del(t.key),this.stale||(i=void 0)),i&&e.call(n,i,t.key,this)}},{key:"keys",value:function(){return this.cache.map(function(e){return e.key})}},{key:"values",value:function(){return this.cache.map(function(e){return e.value})}},{key:"dump",value:function(){var e=this;return this.cache.map(function(t){return e.isStale(t)?void 0:{k:t.key,v:t.value.value,e:t.now+(t.maxAge||0)}}).filter(function(e){return e})}},{key:"dumpLfu",value:function(){return this.cache}},{key:"load",value:function(e){var t=this;this.reset();var n=Date.now();e.forEach(function(e){var i=e.e||0;if(0===i)t.set(e.k,e.v);else{var a=i-n;a>0&&t.set(e.k,e.v,a)}})}},{key:"prune",value:function(){}},{key:"isStale",value:function(e){if(!e||!e.maxAge&&!this.maxAge)return!1;var t=!1,n=Date.now()-e.now;return t=e.maxAge?n>e.maxAge:this.maxAge&&n>this.maxAge}},{key:"trim",value:function(e){for(var t=arguments.length<=1||void 0===arguments[1]?{length:0,key:NaN}:arguments[1],n=void 0;this.length+e-t.length>this.max;){var i=this.cache.pop();i.key===t.key?n=i:this.del(i.key)}n&&this.cache.push(n)}},{key:"length",get:function(){return this.cache.reduce(function(e,t){return t.length},0)}},{key:"itemCount",get:function(){return this.cache.length}}]),e}();t["default"]=r}])});
//# sourceMappingURL=lfu-cache.min.js.map
